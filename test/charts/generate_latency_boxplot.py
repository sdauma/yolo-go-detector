import matplotlib.pyplot as plt
import re

# 读取 Go 基准测试结果
with open("../../results/go_baseline_result.txt", "r", encoding="utf-8") as f:
    go_content = f.read()

# 读取 Python 基准测试结果
with open("../../results/python_baseline_result.txt", "r", encoding="utf-8") as f:
    py_content = f.read()

# 从测试输出中提取所有推理延迟（从实际的测试输出中提取）
# Go 延迟数据（100次推理）
go_latency = [
    833.537, 826.874, 817.220, 822.771, 809.121, 831.955, 820.511,
    815.662, 830.499, 813.888, 825.498, 814.893, 816.825, 808.511,
    822.888, 833.468, 820.791, 822.169, 841.856, 822.125, 821.559,
    819.163, 812.742, 816.942, 810.528, 822.966, 811.572, 841.367,
    807.526, 832.043, 828.469, 811.173, 824.238, 821.748, 811.732,
    822.690, 833.965, 818.152, 925.461, 850.877, 837.756, 815.554,
    831.370, 853.642, 825.811, 831.424, 813.561, 816.029, 825.208,
    846.715, 820.595, 820.592, 828.957, 822.659, 837.024, 804.929,
    805.922, 821.658, 838.986, 809.821, 843.303, 813.313, 844.608,
    821.547, 828.775, 824.922, 810.896, 819.290, 827.864, 832.597,
    810.263, 809.561, 827.219, 821.420, 823.754, 821.543, 831.002,
    824.103, 831.066, 821.952, 813.245, 848.345, 813.547, 821.561,
    835.757, 826.143, 816.089, 810.194, 812.883, 821.589, 820.585,
    814.852, 848.319, 837.049, 828.040, 837.206, 820.341, 818.606,
    817.869, 818.558
]

# Python 延迟数据（100次推理）
py_latency = [
    908.747, 988.204, 918.869, 953.596, 1003.246, 976.099, 901.086,
    943.406, 973.548, 992.719, 929.448, 892.303, 932.733, 982.857,
    941.931, 956.921, 937.290, 962.670, 959.088, 1005.457, 979.573,
    935.228, 992.364, 949.222, 969.414, 954.806, 965.723, 959.187,
    958.046, 960.686, 960.958, 1043.146, 963.505, 1054.237, 1035.294,
    955.756, 934.801, 1018.549, 960.514, 956.499, 950.320, 938.914,
    969.710, 948.506, 937.200, 986.611, 904.362, 961.959, 987.712,
    950.094, 957.862, 1001.168, 980.491, 960.003, 980.763, 916.298,
    924.630, 949.184, 939.289, 914.259, 931.797, 927.511, 979.250,
    910.730, 982.416, 960.142, 972.002, 959.309, 989.501, 996.688,
    964.679, 973.341, 954.772, 1006.291, 971.434, 960.306, 945.897,
    961.470, 961.519, 972.272, 1018.895, 965.533, 989.822, 998.911,
    984.074, 961.628, 956.601, 967.331, 989.072, 977.534, 955.403,
    984.113, 996.609, 972.796, 979.081, 925.574, 889.335, 962.917,
    993.133, 972.197
]

# 创建箱线图
plt.figure(figsize=(8, 5))
box = plt.boxplot(
    [go_latency, py_latency],
    tick_labels=["Go + ONNX Runtime", "Python + ONNX Runtime"],
    showfliers=True,
    patch_artist=True,
    widths=0.6
)

# 设置箱线图颜色
colors = ['#66c2a5', '#fc8d62']
for patch, color in zip(box['boxes'], colors):
    patch.set_facecolor(color)
    patch.set_alpha(0.7)

plt.ylabel("Inference Latency (ms)", fontsize=12)
plt.title("Inference Latency Distribution Comparison", fontsize=14, fontweight='bold')
plt.grid(axis="y", linestyle="--", linewidth=0.5, alpha=0.7)

# 设置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei', 'Arial Unicode MS']
plt.rcParams['axes.unicode_minus'] = False

plt.tight_layout()
plt.savefig("../../results/latency_boxplot.pdf", dpi=300, bbox_inches='tight')
print("延迟箱线图已生成: ../../results/latency_boxplot.pdf")
plt.show()
